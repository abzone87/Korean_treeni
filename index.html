
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Korean Vocabulary Practice</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 1em;
      max-width: 600px;
      margin: auto;
    }
    button {
      padding: 0.5em 1em;
      font-size: 1em;
      cursor: pointer;
      margin: 0.25em;
    }
    input {
      padding: 0.5em;
      font-size: 1em;
      margin: 0.5em;
    }
    .feedback {
      margin-top: 1em;
      font-weight: bold;
    }
    select {
      padding: 0.5em;
      font-size: 1em;
      margin: 0.5em;
    }
    #scoreDisplay {
      margin-top: 1em;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1 style="text-align: center;">Korean Vocabulary Practice</h1>

  <div style="text-align: center;">
    <label for="groupSelect">Select Group:</label>
    <select id="groupSelect" onchange="updateWordPool()">
      <option value="">All Groups</option>
    </select>
  </div>

  <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 0.5em;">
    <button onclick="setMode('mc-ko-en')">Korean → English (MC)</button>
    <button onclick="setMode('mc-en-ko')">English → Korean (MC)</button>
    <button onclick="setMode('write-ko-en')">Korean → English (Write)</button>
    <button onclick="setMode('write-en-ko')">English → Korean (Write)</button>
    <button onclick="setMode('listen-ko-en')">🎧 Listen → English</button>
  </div>

  <div id="scoreDisplay">Score: 0</div>
  <hr>
  <div id="practiceArea" style="text-align: center; margin-top: 1em;"></div>

  <script src="https://cdn.jsdelivr.net/gh/abzone87/Korean_treeni/words.js"></script>
  <script>
    let current = {};
    let mode = '';
    let score = 0;
    let wordStats = JSON.parse(localStorage.getItem('wordStats') || '{}');
    let wordPool = [];

    function setMode(m) {
      mode = m;
      nextQuestion();
    }

    function updateWordPool() {
      const group = document.getElementById('groupSelect').value;
      wordPool = words.filter(w => !group || w.group === group);
      nextQuestion();
    }

    function populateGroupDropdown() {
      const groupSelect = document.getElementById('groupSelect');
      const groups = [...new Set(words.map(w => w.group))];
      groups.forEach(g => {
        const opt = document.createElement('option');
        opt.value = g;
        opt.textContent = g;
        groupSelect.appendChild(opt);
      });
    }

    function nextQuestion() {
      if (wordPool.length === 0) return;
      current = wordPool[Math.floor(Math.random() * wordPool.length)];
      const area = document.getElementById('practiceArea');
      area.innerHTML = '';
      const feedback = document.createElement('div');
      feedback.className = 'feedback';

      if (mode === 'mc-ko-en' || mode === 'mc-en-ko') {
        const question = document.createElement('div');
        question.textContent = mode === 'mc-ko-en' ? current.korean : current.english;
        area.appendChild(question);

        const options = shuffle([current, ...getRandomOptions(3)]);
        options.forEach(opt => {
          const btn = document.createElement('button');
          btn.textContent = mode === 'mc-ko-en' ? opt.english : opt.korean;
          btn.onclick = () => {
            const correct = (opt === current);
            updateStats(current, correct);
            feedback.textContent = correct ? '✅ Correct!' : '❌ Wrong!';
            area.appendChild(feedback);
            if (correct) {
              score++;
              updateScore();
              setTimeout(nextQuestion, 1000);
            }
          };
          area.appendChild(btn);
        });

      } else if (mode === 'write-ko-en' || mode === 'write-en-ko') {
        const question = document.createElement('div');
        question.textContent = mode === 'write-ko-en' ? current.korean : current.english;
        area.appendChild(question);

        const input = document.createElement('input');
        input.type = 'text';
        area.appendChild(input);

        const btn = document.createElement('button');
        btn.textContent = 'Check';
        btn.onclick = () => {
          const answer = input.value.trim().toLowerCase();
          const correctAnswer = (mode === 'write-ko-en' ? current.english : current.korean).toLowerCase();
          const correct = answer === correctAnswer;
          updateStats(current, correct);
          feedback.textContent = correct ? '✅ Correct!' : `❌ Wrong! Correct answer: ${correctAnswer}`;
          area.appendChild(feedback);
          if (correct) {
            score++;
            updateScore();
            setTimeout(nextQuestion, 1000);
          }
        };
        area.appendChild(btn);

      } else if (mode === 'listen-ko-en') {
        const utterance = new SpeechSynthesisUtterance(current.korean);
        utterance.lang = 'ko-KR';
        speechSynthesis.speak(utterance);

        const question = document.createElement('div');
        question.textContent = 'What is the meaning of the spoken Korean word?';
        area.appendChild(question);

        const replayBtn = document.createElement('button');
        replayBtn.textContent = '🔁 Listen again';
        replayBtn.onclick = () => speechSynthesis.speak(utterance);
        area.appendChild(replayBtn);

        const options = shuffle([current, ...getRandomOptions(3)]);
        options.forEach(opt => {
          const btn = document.createElement('button');
          btn.textContent = opt.english;
          btn.onclick = () => {
            const correct = (opt === current);
            updateStats(current, correct);
            feedback.textContent = correct ? '✅ Correct!' : '❌ Wrong!';
            area.appendChild(feedback);
            if (correct) {
              score++;
              updateScore();
              setTimeout(nextQuestion, 1000);
            }
          };
          area.appendChild(btn);
        });
      }

      const stats = wordStats[current.korean] || { attempts: 0, correct: 0 };
      const statLine = document.createElement('div');
      statLine.textContent = `Practiced: ${stats.attempts} | Correct: ${stats.correct}`;
      area.appendChild(document.createElement('br'));
      area.appendChild(statLine);
    }

    function updateStats(word, correct) {
      const key = word.korean;
      if (!wordStats[key]) wordStats[key] = { attempts: 0, correct: 0 };
      wordStats[key].attempts++;
      if (correct) wordStats[key].correct++;
      localStorage.setItem('wordStats', JSON.stringify(wordStats));
    }

    function updateScore() {
      document.getElementById('scoreDisplay').textContent = 'Score: ' + score;
    }

    function getRandomOptions(n) {
      const shuffled = wordPool.filter(w => w !== current).sort(() => 0.5 - Math.random());
      return shuffled.slice(0, n);
    }

    function shuffle(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    window.onload = () => {
      populateGroupDropdown();
      updateWordPool();
    };
  </script>
</body>
</html>


